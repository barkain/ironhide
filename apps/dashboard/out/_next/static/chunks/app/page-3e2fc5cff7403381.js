(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{35309:(e,s,t)=>{"use strict";t.d(s,{U:()=>n,l:()=>r});var a=t(87715);function n(){return new a.E({defaultOptions:{queries:{staleTime:3e4,gcTime:3e5,retry:3,refetchOnWindowFocus:!1,refetchOnReconnect:!0},mutations:{retry:1}}})}let r={sessions:{all:["sessions"],list:e=>[...r.sessions.all,"list",e],detail:e=>[...r.sessions.all,"detail",e]},turns:{all:["turns"],list:(e,s)=>[...r.turns.all,"list",e,s],detail:e=>[...r.turns.all,"detail",e]},metrics:{all:["metrics"],session:e=>[...r.metrics.all,"session",e]}}},44572:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>sL});var a=t(54568),n=t(7620),r=t(27541),l=t(46118),i=t(54616),o=t(72902),c=t(13714);function d(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,c.QP)((0,o.$)(s))}function u(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:4,maximumFractionDigits:4}).format(e)}function m(e){return new Intl.NumberFormat("en-US").format(e)}function x(e){if(e<1e3)return"".concat(e,"ms");if(e<6e4)return"".concat((e/1e3).toFixed(1),"s");let s=Math.floor(e/6e4),t=(e%6e4/1e3).toFixed(0);return"".concat(s,"m ").concat(t,"s")}function h(e){return"".concat(e.toFixed(1),"%")}function g(e,s){return e.length<=s?e:e.slice(0,s-3)+"..."}let f=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p=n.forwardRef((e,s)=>{let{className:t,variant:n,size:r,asChild:i=!1,...o}=e,c=i?l.DX:"button";return(0,a.jsx)(c,{className:d(f({variant:n,size:r,className:t})),ref:s,...o})});p.displayName="Button";let j=(0,i.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80"}},defaultVariants:{variant:"default"}});function v(e){let{className:s,variant:t,...n}=e;return(0,a.jsx)("div",{className:d(j({variant:t}),s),...n})}var N=t(28239),b=t(45234),w=t(23239);function y(e){let{status:s,onReconnect:t}=e,n={connected:{label:"Live",variant:"success",icon:N.A,pulse:!0},connecting:{label:"Connecting",variant:"warning",icon:b.A,pulse:!1},disconnected:{label:"Disconnected",variant:"secondary",icon:w.A,pulse:!1},error:{label:"Error",variant:"destructive",icon:w.A,pulse:!1}}[s],r=n.icon;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(v,{variant:n.variant,className:d("flex items-center gap-1",n.pulse&&"animate-pulse"),children:[(0,a.jsx)(r,{className:d("h-3 w-3","connecting"===s&&"animate-spin")}),n.label]}),("disconnected"===s||"error"===s)&&t&&(0,a.jsxs)(p,{variant:"ghost",size:"sm",onClick:t,children:[(0,a.jsx)(b.A,{className:"h-3 w-3 mr-1"}),"Reconnect"]})]})}var k=t(71620),C=t(50848);let A={theme:"system",sidebarCollapsed:!1,selectedTimeRange:"all",realTimeEnabled:!0,autoRefreshInterval:30,showTokenBreakdown:!0,showCostBreakdown:!0},S=(0,k.v)()((0,C.Zr)(e=>({...A,setTheme:s=>e({theme:s}),toggleSidebar:()=>e(e=>({sidebarCollapsed:!e.sidebarCollapsed})),setSidebarCollapsed:s=>e({sidebarCollapsed:s}),setTimeRange:s=>e({selectedTimeRange:s}),setRealTimeEnabled:s=>e({realTimeEnabled:s}),setAutoRefreshInterval:s=>e({autoRefreshInterval:s}),setShowTokenBreakdown:s=>e({showTokenBreakdown:s}),setShowCostBreakdown:s=>e({showCostBreakdown:s}),reset:()=>e(A)}),{name:"analytics-settings",partialize:e=>({theme:e.theme,sidebarCollapsed:e.sidebarCollapsed,selectedTimeRange:e.selectedTimeRange,realTimeEnabled:e.realTimeEnabled,autoRefreshInterval:e.autoRefreshInterval,showTokenBreakdown:e.showTokenBreakdown,showCostBreakdown:e.showCostBreakdown})}));var T=t(80229),R=t(13119),F=t(92568),L=t(51115),M=t(18255),D=t(19664),E=t.n(D);function U(e){let{connectionStatus:s,onReconnect:t,onToggleSidebar:n}=e,{theme:r,setTheme:l}=S();return(0,a.jsx)("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,a.jsxs)("div",{className:"container flex h-14 items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[n&&(0,a.jsx)(p,{variant:"ghost",size:"icon",onClick:n,className:"md:hidden",children:(0,a.jsx)(T.A,{className:"h-5 w-5"})}),(0,a.jsxs)(E(),{href:"/",className:"flex items-center gap-2",children:[(0,a.jsx)(R.A,{className:"h-6 w-6 text-primary"}),(0,a.jsx)("span",{className:"font-bold hidden sm:inline",children:"Claude Code Analytics"})]})]}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[s&&(0,a.jsx)(y,{status:s,onReconnect:t}),(0,a.jsx)(p,{variant:"ghost",size:"icon",onClick:()=>{l("dark"===r?"light":"dark")},children:"dark"===r?(0,a.jsx)(F.A,{className:"h-5 w-5"}):(0,a.jsx)(L.A,{className:"h-5 w-5"})}),(0,a.jsx)(E(),{href:"/settings",children:(0,a.jsx)(p,{variant:"ghost",size:"icon",children:(0,a.jsx)(M.A,{className:"h-5 w-5"})})})]})]})})}var I=t(47537),B=t(33397);let P=n.forwardRef((e,s)=>{let{className:t,children:n,...r}=e;return(0,a.jsxs)(B.bL,{ref:s,className:d("relative overflow-hidden",t),...r,children:[(0,a.jsx)(B.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(z,{}),(0,a.jsx)(B.OK,{})]})});P.displayName=B.bL.displayName;let z=n.forwardRef((e,s)=>{let{className:t,orientation:n="vertical",...r}=e;return(0,a.jsx)(B.VM,{ref:s,orientation:n,className:d("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:(0,a.jsx)(B.lr,{className:"relative flex-1 rounded-full bg-border"})})});function K(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("animate-pulse rounded-md bg-muted",s),...t})}z.displayName=B.VM.displayName;var O=t(92140),q=t(27797),W=t(74624),H=t(3094);function _(e){let{sessions:s,selectedSessionId:t,isLoading:n}=e,l=(0,r.useRouter)();return n?(0,a.jsx)("div",{className:"space-y-3 p-4",children:Array.from({length:5}).map((e,s)=>(0,a.jsx)(V,{},s))}):0===s.length?(0,a.jsx)("div",{className:"p-4 text-center text-muted-foreground",children:(0,a.jsx)("p",{children:"No sessions found"})}):(0,a.jsx)(P,{className:"h-[calc(100vh-200px)]",children:(0,a.jsx)("div",{className:"space-y-2 p-4",children:s.map(e=>(0,a.jsx)($,{session:e,isSelected:e.id===t,onClick:()=>l.push("/?session=".concat(e.id))},e.id))})})}function $(e){let{session:s,isSelected:t,onClick:n}=e,r=new Date(s.lastActivityAt);return(0,a.jsxs)("button",{onClick:n,className:d("w-full text-left p-3 rounded-lg border transition-colors",t?"bg-primary/10 border-primary":"bg-card hover:bg-accent border-border"),children:[(0,a.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(O.A,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,a.jsx)("span",{className:"font-medium truncate",children:s.projectName}),s.isActive&&(0,a.jsx)(v,{variant:"success",className:"shrink-0",children:"Active"})]}),s.branch&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1 text-sm text-muted-foreground",children:[(0,a.jsx)(q.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"truncate",children:s.branch})]})]})}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(W.A,{className:"h-3 w-3"}),(0,I.m)(r,{addSuffix:!0})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(H.A,{className:"h-3 w-3"}),u(s.summary.totalCost)]}),(0,a.jsxs)("span",{children:[m(s.summary.totalTurns)," turns"]})]})]})}function V(){return(0,a.jsxs)("div",{className:"p-3 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(K,{className:"h-4 w-4 rounded"}),(0,a.jsx)(K,{className:"h-4 w-32"})]}),(0,a.jsx)(K,{className:"h-3 w-24 mt-2"}),(0,a.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,a.jsx)(K,{className:"h-3 w-16"}),(0,a.jsx)(K,{className:"h-3 w-12"}),(0,a.jsx)(K,{className:"h-3 w-14"})]})]})}var Q=t(85973);let J=[{value:"1h",label:"1 Hour"},{value:"6h",label:"6 Hours"},{value:"24h",label:"24 Hours"},{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"},{value:"all",label:"All Time"}];function X(e){let{sessions:s,selectedSessionId:t,isLoading:n}=e,{sidebarCollapsed:r,setSidebarCollapsed:l,selectedTimeRange:i,setTimeRange:o}=S();return(0,a.jsx)("aside",{className:d("fixed left-0 top-14 z-40 h-[calc(100vh-3.5rem)] border-r bg-background transition-all duration-300",r?"w-0 overflow-hidden":"w-80"),children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h2",{className:"font-semibold",children:"Sessions"}),(0,a.jsx)(p,{variant:"ghost",size:"icon",onClick:()=>l(!0),children:(0,a.jsx)(Q.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Time Range"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:J.map(e=>(0,a.jsx)(p,{variant:i===e.value?"default":"ghost",size:"sm",onClick:()=>o(e.value),className:"text-xs",children:e.label},e.value))})]}),(0,a.jsx)(_,{sessions:s,selectedSessionId:t,isLoading:n})]})})}function G(e){let{isCollapsed:s,onToggle:t}=e;return s?(0,a.jsx)(p,{variant:"ghost",size:"icon",onClick:t,className:"fixed left-4 top-20 z-40",children:(0,a.jsx)(Q.A,{className:"h-4 w-4 rotate-180"})}):null}let Y=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:d("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});Y.displayName="Card";let Z=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:d("flex flex-col space-y-1.5 p-6",t),...n})});Z.displayName="CardHeader";let ee=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:s,className:d("text-2xl font-semibold leading-none tracking-tight",t),...n})});ee.displayName="CardTitle",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:s,className:d("text-sm text-muted-foreground",t),...n})}).displayName="CardDescription";let es=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:d("p-6 pt-0",t),...n})});es.displayName="CardContent",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:d("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter";var et=t(38078),ea=t(58997);function en(e){let{session:s}=e,t=(0,r.useRouter)(),n=new Date(s.lastActivityAt),l=new Date(s.startedAt),i=n.getTime()-l.getTime();return(0,a.jsxs)(Y,{className:"hover:bg-accent/50 transition-colors cursor-pointer",onClick:()=>{t.push("/?session=".concat(s.id))},children:[(0,a.jsxs)(Z,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(O.A,{className:"h-5 w-5 text-muted-foreground"}),(0,a.jsx)(ee,{className:"text-lg",children:s.projectName})]}),s.isActive&&(0,a.jsx)(v,{variant:"success",children:"Active"})]}),s.branch&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.branch})]})]}),(0,a.jsxs)(es,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Turns"}),(0,a.jsx)("p",{className:"font-medium",children:m(s.summary.totalTurns)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(H.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cost"}),(0,a.jsx)("p",{className:"font-medium",children:u(s.summary.totalCost)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tokens"}),(0,a.jsx)("p",{className:"font-medium",children:m(s.summary.totalTokens)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Duration"}),(0,a.jsx)("p",{className:"font-medium",children:x(i)})]})]})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-4",children:["Last activity ",(0,I.m)(n,{addSuffix:!0})]})]})]})}function er(e){let{title:s,value:t,subtitle:n,icon:r,iconColor:l="text-muted-foreground",trend:i,isLoading:o}=e;return o?(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{className:"pb-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(K,{className:"h-5 w-5 rounded"}),(0,a.jsx)(K,{className:"h-4 w-24"})]})}),(0,a.jsxs)(es,{children:[(0,a.jsx)(K,{className:"h-8 w-32 mb-1"}),(0,a.jsx)(K,{className:"h-3 w-20"})]})]}):(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{className:"pb-2",children:(0,a.jsxs)(ee,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[r&&(0,a.jsx)(r,{className:d("h-4 w-4",l)}),s]})}),(0,a.jsxs)(es,{children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:t}),n&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n}),i&&(0,a.jsxs)("p",{className:d("text-xs mt-1",i.isPositive?"text-green-600":"text-red-600"),children:[i.isPositive?"+":"",i.value,"% ",i.label]})]})]})}function el(e){let{sessions:s,total:t,isLoading:n}=e,r=s.reduce((e,s)=>({totalCost:e.totalCost+s.summary.totalCost,totalTokens:e.totalTokens+s.summary.totalTokens,totalTurns:e.totalTurns+s.summary.totalTurns,activeSessions:e.activeSessions+ +!!s.isActive}),{totalCost:0,totalTokens:0,totalTurns:0,activeSessions:0});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Overview of your Claude Code sessions and usage"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,a.jsx)(er,{title:"Total Cost",value:u(r.totalCost),icon:H.A,iconColor:"text-green-600",isLoading:n}),(0,a.jsx)(er,{title:"Total Tokens",value:m(r.totalTokens),icon:ea.A,iconColor:"text-yellow-600",isLoading:n}),(0,a.jsx)(er,{title:"Total Turns",value:m(r.totalTurns),icon:et.A,iconColor:"text-blue-600",isLoading:n}),(0,a.jsx)(er,{title:"Active Sessions",value:r.activeSessions,subtitle:"of ".concat(t," total"),icon:R.A,iconColor:"text-purple-600",isLoading:n})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Sessions"})}),n?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,s)=>(0,a.jsx)(K,{className:"h-48 rounded-lg"},s))}):0===s.length?(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,a.jsx)(R.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"No sessions found"}),(0,a.jsx)("p",{className:"text-sm",children:"Start using Claude Code to see your sessions here"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>(0,a.jsx)(en,{session:e},e.id))})]})}var ei=t(65686),eo=t(64751);function ec(e){let{session:s,metrics:t,onRefresh:n,isRefreshing:r}=e,l=new Date(s.startedAt),i=new Date(s.lastActivityAt);return(0,a.jsxs)("div",{className:"border-b pb-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(E(),{href:"/",children:(0,a.jsx)(p,{variant:"ghost",size:"icon",children:(0,a.jsx)(eo.A,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:s.projectName}),s.isActive&&(0,a.jsx)(v,{variant:"success",children:"Active"})]}),s.branch&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground mt-1",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.branch})]})]}),n&&(0,a.jsxs)(p,{variant:"outline",size:"sm",onClick:n,disabled:r,children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2 ".concat(r?"animate-spin":"")}),"Refresh"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-6 text-sm text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(W.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Started ",(0,ei.GP)(l,"MMM d, yyyy h:mm a")]})]}),(0,a.jsxs)("div",{children:["Last activity ",(0,I.m)(i,{addSuffix:!0})]}),t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Duration: ",x(t.totalDurationMs)]}),(0,a.jsxs)("div",{children:["Model: ",s.model]})]})]})]})}function ed(e){let{totalCost:s,costBreakdown:t,avgCostPerTurn:n,showBreakdown:r=!0}=e;return(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{className:"pb-2",children:(0,a.jsxs)(ee,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(H.A,{className:"h-5 w-5 text-green-600"}),"Total Cost"]})}),(0,a.jsxs)(es,{children:[(0,a.jsx)("p",{className:"text-3xl font-bold",children:u(s)}),void 0!==n&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[u(n)," per turn avg"]}),r&&t&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Input tokens"}),(0,a.jsx)("span",{children:u(t.input)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Output tokens"}),(0,a.jsx)("span",{children:u(t.output)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Cache creation"}),(0,a.jsx)("span",{children:u(t.cacheCreation)})]})]})]})]})}var eu=t(95665);let em=n.forwardRef((e,s)=>{let{className:t,value:n,indicatorClassName:r,...l}=e;return(0,a.jsx)(eu.bL,{ref:s,className:d("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...l,children:(0,a.jsx)(eu.C1,{className:d("h-full w-full flex-1 bg-primary transition-all",r),style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});function ex(e){let{efficiency:s}=e,{compositeScore:t,cacheUtilization:n,toolSuccessRate:r,contextEfficiency:l}=s;return(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{className:"pb-2",children:(0,a.jsxs)(ee,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"h-5 w-5 text-yellow-500"}),"Efficiency Score"]})}),(0,a.jsxs)(es,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)("p",{className:"text-4xl font-bold",children:t.toFixed(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:t>=80?"Excellent":t>=60?"Good":t>=40?"Fair":"Needs Improvement"}),(0,a.jsx)(em,{value:t,className:"w-32 h-2",indicatorClassName:t>=80?"bg-green-500":t>=60?"bg-yellow-500":"bg-red-500"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(eh,{label:"Cache Utilization",value:n,description:"How effectively cache is being used"}),(0,a.jsx)(eh,{label:"Tool Success Rate",value:r,description:"Percentage of successful tool calls"}),(0,a.jsx)(eh,{label:"Context Efficiency",value:l,description:"Output per context window used"})]})]})]})}function eh(e){let{label:s,value:t,description:n}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,a.jsx)("span",{children:s}),(0,a.jsx)("span",{className:"font-medium",children:h(t)})]}),(0,a.jsx)(em,{value:t,className:"h-1.5",indicatorClassName:t>=80?"bg-green-500":t>=60?"bg-yellow-500":"bg-red-500"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})}em.displayName=eu.bL.displayName;var eg=t(79886),ef=t(29942),ep=t(75724),ej=t(94503),ev=t(65236),eN=t(78875),eb=t(31233),ew=t(29440),ey=t(37528),ek=t(40999),eC=t(30866);function eA(e){let{content:s,className:t}=e;return(0,a.jsxs)("span",{className:d("relative inline-flex items-center group",t),children:[(0,a.jsx)(eC.A,{className:"h-3.5 w-3.5 text-muted-foreground cursor-help"}),(0,a.jsx)("span",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-3 py-2 text-xs text-popover-foreground bg-popover border rounded-md shadow-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-normal w-64 z-50 pointer-events-none",children:s})]})}var eS=t(46625),eT=t(12598);let eR=eS.bL;eS.l9;let eF=eS.ZL;eS.bm;let eL=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(eS.hJ,{ref:s,className:d("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});eL.displayName=eS.hJ.displayName;let eM=n.forwardRef((e,s)=>{let{className:t,children:n,...r}=e;return(0,a.jsxs)(eF,{children:[(0,a.jsx)(eL,{}),(0,a.jsxs)(eS.UC,{ref:s,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[n,(0,a.jsxs)(eS.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(eT.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eM.displayName=eS.UC.displayName;let eD=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};eD.displayName="DialogHeader";let eE=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(eS.hE,{ref:s,className:d("text-lg font-semibold leading-none tracking-tight",t),...n})});function eU(e){let{open:s,onOpenChange:t,title:r,children:l}=e,[i,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(0),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(s){o(!1);let e=setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{o(!0),d(e=>e+1)})})},350);return()=>clearTimeout(e)}o(!1)},[s]);let m=(0,n.useCallback)(()=>{i&&d(e=>e+1)},[i]);return(0,n.useEffect)(()=>{if(s&&i)return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[s,i,m]),(0,a.jsx)(eR,{open:s,onOpenChange:t,children:(0,a.jsxs)(eM,{className:"max-w-5xl w-[90vw] max-h-[90vh] overflow-hidden",children:[(0,a.jsx)(eD,{children:(0,a.jsx)(eE,{children:r})}),(0,a.jsx)("div",{ref:u,className:"h-[70vh] min-h-[400px] w-full",children:i?(0,a.jsx)("div",{className:"w-full h-full",children:l},c):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Loading chart..."})})]})})}function eI(e){let{expandedContent:s,fallback:t}=e;return s?"function"==typeof s?(0,a.jsx)(a.Fragment,{children:s()}):(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)(a.Fragment,{children:t})}function eB(e){let{title:s,children:t,expandedContent:r,info:l}=e,[i,o]=(0,n.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Y,{children:[(0,a.jsxs)(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)(ee,{className:"text-lg flex items-center gap-1.5",children:[s,l&&(0,a.jsx)(eA,{content:l})]}),(0,a.jsx)("button",{onClick:()=>o(!0),className:"rounded-md p-1.5 hover:bg-muted transition-colors","aria-label":"Expand chart",children:(0,a.jsx)(ek.A,{className:"h-4 w-4 text-muted-foreground"})})]}),(0,a.jsx)(es,{children:(0,a.jsx)("div",{className:"h-[300px]",children:t})})]}),(0,a.jsx)(eU,{open:i,onOpenChange:o,title:s,children:(0,a.jsx)(eI,{expandedContent:r,fallback:t})})]})}function eP(e){let{chartData:s,showBreakdown:t,showBrush:n=!1,isExpanded:r=!1}=e,l=s.length,i=r?0:Math.max(0,l-50),o=Math.max(0,l-1),c=Math.max(...s.map(e=>Math.max(e.total,e.input,e.output,e.cacheRead)),1);return(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsxs)(ef.b,{data:s,margin:{top:10,right:30,left:0,bottom:30*!!n},children:[(0,a.jsx)(ep.d,{strokeDasharray:"3 3",className:"stroke-muted"}),(0,a.jsx)(ej.W,{dataKey:"turn",className:"text-xs",tickFormatter:e=>"Turn ".concat(e)}),(0,a.jsx)(ev.h,{className:"text-xs",tickFormatter:e=>m(e),domain:[0,c]}),(0,a.jsx)(eN.m,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"},formatter:(e,s)=>[m(e),s],labelFormatter:e=>"Turn ".concat(e)}),t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.s,{}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"input",stroke:"hsl(var(--chart-1))",strokeWidth:2,dot:!1,name:"Input",connectNulls:!0,isAnimationActive:!1}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"output",stroke:"hsl(var(--chart-2))",strokeWidth:2,dot:!1,name:"Output",connectNulls:!0,isAnimationActive:!1}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"cacheRead",stroke:"hsl(var(--chart-3))",strokeWidth:2,dot:!1,name:"Cache Read",connectNulls:!0,isAnimationActive:!1})]}):(0,a.jsx)(ew.N,{type:"monotone",dataKey:"total",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1,name:"Total Tokens",connectNulls:!0,isAnimationActive:!1}),n&&l>10&&(0,a.jsx)(ey.v,{dataKey:"turn",height:30,stroke:"hsl(var(--primary))",fill:"hsl(var(--muted))",startIndex:i,endIndex:o,tickFormatter:e=>"T".concat(e)},"brush-".concat(l,"-").concat(r))]})})}function ez(e){let{data:s,showBreakdown:t=!0}=e,n=s.map(e=>{var s,t,a,n,r,l;let i=null!=(s=e.tokens)?s:{input:0,output:0,cacheCreation:0,cacheRead:0,total:0};return{turn:e.turnNumber,input:null!=(t=i.input)?t:0,output:null!=(a=i.output)?a:0,cacheCreation:null!=(n=i.cacheCreation)?n:0,cacheRead:null!=(r=i.cacheRead)?r:0,total:null!=(l=i.total)?l:0}});if(s.length>0){var r,l,i;console.log("[TokenUsageChart] Raw metric data:",{turnNumber:null==(r=s[0])?void 0:r.turnNumber,tokens:null==(l=s[0])?void 0:l.tokens,durationMs:null==(i=s[0])?void 0:i.durationMs}),console.log("[TokenUsageChart] Processed chart data:",n[0])}return!n.some(e=>e.total>0||e.input>0||e.output>0)&&n.length>0&&console.warn("[TokenUsageChart] All token values are zero. Check if token data is being parsed correctly from JSONL."),(0,a.jsx)(eB,{title:"Token Usage Over Turns",info:"A turn is one complete user prompt → assistant response cycle, including all tool uses in between.",expandedContent:()=>(0,a.jsx)(eP,{chartData:n,showBreakdown:!0,showBrush:!0,isExpanded:!0}),children:(0,a.jsx)(eP,{chartData:n,showBreakdown:t})})}function eK(e){let{chartData:s,showBreakdown:t,showBrush:n=!1,isExpanded:r=!1}=e,l=s.length,i=r?0:Math.max(0,l-50),o=Math.max(0,l-1),c=Math.max(...s.map(e=>Math.max(e.total,e.input,e.output,e.cacheCreation)),.01);return(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsxs)(ef.b,{data:s,margin:{top:10,right:30,left:0,bottom:30*!!n},children:[(0,a.jsx)(ep.d,{strokeDasharray:"3 3",className:"stroke-muted"}),(0,a.jsx)(ej.W,{dataKey:"turn",className:"text-xs",tickFormatter:e=>"Turn ".concat(e)}),(0,a.jsx)(ev.h,{className:"text-xs",tickFormatter:e=>"$".concat(e.toFixed(2)),domain:[0,c]}),(0,a.jsx)(eN.m,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"},formatter:(e,s)=>[u(e),s],labelFormatter:e=>"Turn ".concat(e)}),t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.s,{}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"input",stroke:"hsl(var(--chart-1))",strokeWidth:2,dot:!1,name:"Input Cost",connectNulls:!0,isAnimationActive:!1}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"output",stroke:"hsl(var(--chart-2))",strokeWidth:2,dot:!1,name:"Output Cost",connectNulls:!0,isAnimationActive:!1}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"cacheCreation",stroke:"hsl(var(--chart-3))",strokeWidth:2,dot:!1,name:"Cache Creation",connectNulls:!0,isAnimationActive:!1})]}):(0,a.jsx)(ew.N,{type:"monotone",dataKey:"total",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1,name:"Total Cost",connectNulls:!0,isAnimationActive:!1}),n&&l>10&&(0,a.jsx)(ey.v,{dataKey:"turn",height:30,stroke:"hsl(var(--primary))",fill:"hsl(var(--muted))",startIndex:i,endIndex:o,tickFormatter:e=>"T".concat(e)},"brush-".concat(l,"-").concat(r))]})})}function eO(e){let{data:s,showBreakdown:t=!0}=e,n=0,r=0,l=0,i=0,o=s.map(e=>{var s,t,a,o,c,d;let u=null!=(s=e.cost)?s:{input:0,output:0,cacheCreation:0,total:0};return n+=null!=(t=u.total)?t:0,r+=null!=(a=u.input)?a:0,l+=null!=(o=u.output)?o:0,i+=null!=(c=u.cacheCreation)?c:0,{turn:e.turnNumber,total:n,input:r,output:l,cacheCreation:i,turnCost:null!=(d=u.total)?d:0}});if(s.length>0){var c,d,u;console.log("[CostChart] Raw metric data:",{turnNumber:null==(c=s[0])?void 0:c.turnNumber,cost:null==(d=s[0])?void 0:d.cost,durationMs:null==(u=s[0])?void 0:u.durationMs}),console.log("[CostChart] Processed chart data:",o[0])}return!o.some(e=>e.total>0||e.turnCost>0)&&o.length>0&&console.warn("[CostChart] All cost values are zero. Check if cost data is being calculated correctly."),(0,a.jsx)(eB,{title:"Cumulative Cost Over Turns",info:"A turn is one complete user prompt → assistant response cycle, including all tool uses in between.",expandedContent:()=>(0,a.jsx)(eK,{chartData:o,showBreakdown:!0,showBrush:!0,isExpanded:!0}),children:(0,a.jsx)(eK,{chartData:o,showBreakdown:t})})}function eq(e){let{chartData:s,showBrush:t=!1,isExpanded:n=!1}=e,r=s.length,l=n?0:Math.max(0,r-50),i=Math.max(0,r-1);return(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsxs)(ef.b,{data:s,margin:{top:10,right:30,left:0,bottom:30*!!t},children:[(0,a.jsx)(ep.d,{strokeDasharray:"3 3",className:"stroke-muted"}),(0,a.jsx)(ej.W,{dataKey:"turn",className:"text-xs",tickFormatter:e=>"T".concat(e)}),(0,a.jsx)(ev.h,{className:"text-xs",tickFormatter:e=>x(e)}),(0,a.jsx)(eN.m,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"},formatter:e=>[x(e),"Duration"],labelFormatter:e=>"Turn ".concat(e)}),(0,a.jsx)(ew.N,{type:"monotone",dataKey:"duration",stroke:"hsl(var(--chart-4))",strokeWidth:2,dot:!1,name:"Duration"}),t&&r>10&&(0,a.jsx)(ey.v,{dataKey:"turn",height:30,stroke:"hsl(var(--chart-4))",fill:"hsl(var(--muted))",startIndex:l,endIndex:i,tickFormatter:e=>"T".concat(e)},"brush-".concat(r,"-").concat(n))]})})}function eW(e){let{data:s}=e,t=s.map(e=>({turn:e.turnNumber,duration:e.durationMs}));return(0,a.jsx)(eB,{title:"Turn Duration",info:"A turn is one complete user prompt → assistant response cycle, including all tool uses in between.",expandedContent:()=>(0,a.jsx)(eq,{chartData:t,showBrush:!0,isExpanded:!0}),children:(0,a.jsx)(eq,{chartData:t})})}eE.displayName=eS.hE.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(eS.VY,{ref:s,className:d("text-sm text-muted-foreground",t),...n})}).displayName=eS.VY.displayName;var eH=t(57948),e_=t(2994),e$=t(61145);function eV(e){let{value:s}=e,t=[{name:"used",value:s},{name:"remaining",value:100-s}];return(0,a.jsxs)("div",{className:"h-full relative",children:[(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsx)(eH.r,{children:(0,a.jsxs)(e_.F,{data:t,cx:"50%",cy:"50%",startAngle:180,endAngle:0,innerRadius:60,outerRadius:80,paddingAngle:0,dataKey:"value",children:[(0,a.jsx)(e$.f,{fill:s<50?"hsl(var(--chart-2))":s<80?"hsl(var(--chart-4))":"hsl(var(--destructive))"}),(0,a.jsx)(e$.f,{fill:"hsl(var(--muted))"})]})})}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center -mt-4",children:[(0,a.jsx)("p",{className:"text-3xl font-bold",children:h(s)}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"of context window"})]})})]})}function eQ(e){let{value:s,label:t="Context Usage"}=e,[r,l]=(0,n.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Y,{children:[(0,a.jsxs)(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(ee,{className:"text-lg",children:t}),(0,a.jsx)("button",{onClick:()=>l(!0),className:"rounded-md p-1.5 hover:bg-muted transition-colors","aria-label":"Expand chart",children:(0,a.jsx)(ek.A,{className:"h-4 w-4 text-muted-foreground"})})]}),(0,a.jsx)(es,{children:(0,a.jsx)("div",{className:"h-[200px]",children:(0,a.jsx)(eV,{value:s})})})]}),(0,a.jsx)(eU,{open:r,onOpenChange:l,title:t,children:(0,a.jsx)(eV,{value:s})})]})}var eJ=t(65087),eX=t(4121),eG=t(62070);function eY(e){let{chartData:s,showBrush:t=!1,isExpanded:n=!1}=e,r=s.length,l=n?0:Math.max(0,r-50),i=Math.max(0,r-1);return(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsxs)(eJ.E,{data:s,margin:{top:10,right:30,left:0,bottom:30*!!t},children:[(0,a.jsx)(ep.d,{strokeDasharray:"3 3",className:"stroke-muted"}),(0,a.jsx)(ej.W,{dataKey:"turn",className:"text-xs",tickFormatter:e=>"T".concat(e)}),(0,a.jsx)(ev.h,{className:"text-xs",domain:["auto","auto"],tickFormatter:e=>m(Math.abs(e))}),(0,a.jsx)(eX.e,{y:0,stroke:"hsl(var(--border))"}),(0,a.jsx)(eN.m,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"},formatter:(e,s)=>[m(Math.abs(e)),s],labelFormatter:e=>"Turn ".concat(e)}),(0,a.jsx)(eb.s,{}),(0,a.jsx)(eG.y,{dataKey:"added",fill:"hsl(142 76% 36%)",name:"Lines Added",radius:[4,4,0,0]}),(0,a.jsx)(eG.y,{dataKey:"removed",fill:"hsl(0 84% 60%)",name:"Lines Removed",radius:[4,4,0,0]}),t&&r>10&&(0,a.jsx)(ey.v,{dataKey:"turn",height:30,stroke:"hsl(142 76% 36%)",fill:"hsl(var(--muted))",startIndex:l,endIndex:i,tickFormatter:e=>"T".concat(e)},"brush-".concat(r,"-").concat(n))]})})}function eZ(e){let{data:s}=e,t=s.map(e=>{var s,t,a,n,r,l,i;let o=null!=(s=e.codeMetrics)?s:{linesAdded:0,linesRemoved:0,netLinesChanged:0,filesCreated:0,filesModified:0,filesDeleted:0};return{turn:e.turnNumber,added:null!=(t=o.linesAdded)?t:0,removed:-(null!=(a=o.linesRemoved)?a:0),net:null!=(n=o.netLinesChanged)?n:0,filesCreated:null!=(r=o.filesCreated)?r:0,filesModified:null!=(l=o.filesModified)?l:0,filesDeleted:null!=(i=o.filesDeleted)?i:0}});return(0,a.jsx)(eB,{title:"Code Changes",info:"A turn is one complete user prompt → assistant response cycle, including all tool uses in between.",expandedContent:()=>(0,a.jsx)(eY,{chartData:t,showBrush:!0,isExpanded:!0}),children:(0,a.jsx)(eY,{chartData:t})})}let e0=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(220 70% 50%)","hsl(160 60% 45%)","hsl(30 80% 55%)"];function e1(e){let{data:s,total:t}=e;return(0,a.jsx)(eg.u,{width:"100%",height:"100%",children:(0,a.jsxs)(eH.r,{children:[(0,a.jsx)(e_.F,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",label:e=>{let{name:s,percent:t}=e;return t>.05?"".concat(s," (").concat((100*t).toFixed(0),"%)"):""},labelLine:!1,children:s.map((e,s)=>(0,a.jsx)(e$.f,{fill:e0[s%e0.length]},e.name))}),(0,a.jsx)(eN.m,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)",color:"hsl(var(--foreground))"},itemStyle:{color:"hsl(var(--foreground))"},formatter:(e,s)=>["".concat(m(e)," (").concat((e/t*100).toFixed(1),"%)"),s]}),(0,a.jsx)(eb.s,{layout:"vertical",align:"right",verticalAlign:"middle",formatter:e=>(0,a.jsx)("span",{className:"text-sm",children:e})})]})})}function e4(e){let{toolBreakdown:s}=e,t=Object.entries(s).map(e=>{let[s,t]=e;return{name:s,value:t}}).sort((e,s)=>s.value-e.value).slice(0,8),n=t.reduce((e,s)=>e+s.value,0);return(0,a.jsx)(eB,{title:"Tool Usage",children:(0,a.jsx)(e1,{data:t,total:n})})}let e2=n.forwardRef((e,s)=>{let{className:t,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:d("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});e2.displayName="Input";var e5=t(72116);let e3=n.forwardRef((e,s)=>{let{className:t,children:n,...r}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{className:d("flex h-9 w-full appearance-none items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 pr-8",t),ref:s,...r,children:n}),(0,a.jsx)(e5.A,{className:"absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 opacity-50 pointer-events-none"})]})});e3.displayName="Select";var e6=t(65202),e8=t(54366),e9=t(84244),e7=t(84990),se=t(95577),ss=t(80021);function st(e){var s,t,r,l,i,o;let{turns:c,metrics:d,isLoading:u,onLoadMore:m,hasMore:x}=e,[h,g]=(0,n.useState)(null),[f,j]=(0,n.useState)(""),[N,b]=(0,n.useState)("turnNumber"),[w,y]=(0,n.useState)("asc"),[k,C]=(0,n.useState)({minDuration:null,minContextUsage:null,minCost:null}),[A,S]=(0,n.useState)(!1),[T,R]=(0,n.useState)(!1),F=new Map(d.map(e=>[e.turnId,e])),L=(0,n.useMemo)(()=>c.filter(e=>e.isSubagent).length,[c]),M=(0,n.useMemo)(()=>{let e=[...c];if(T||(e=e.filter(e=>!e.isSubagent)),f.trim()){let s=f.toLowerCase();e=e.filter(e=>e.userMessage.toLowerCase().includes(s)||e.assistantMessage.toLowerCase().includes(s))}return null!==k.minDuration&&(e=e.filter(e=>{var s,t;let a=F.get(e.id);return(null!=(t=null!=(s=null==a?void 0:a.durationMs)?s:e.durationMs)?t:0)>=1e3*k.minDuration})),null!==k.minContextUsage&&(e=e.filter(e=>{var s;let t=F.get(e.id);return(null!=(s=null==t?void 0:t.contextUsagePercent)?s:0)>=k.minContextUsage})),null!==k.minCost&&(e=e.filter(e=>{var s,t;let a=F.get(e.id);return(null!=(t=null==a||null==(s=a.cost)?void 0:s.total)?t:0)>=k.minCost})),e.sort((e,s)=>{var t,a,n,r,l,i,o,c,d,u;let m=F.get(e.id),x=F.get(s.id),h=0;switch(N){case"turnNumber":h=e.turnNumber-s.turnNumber;break;case"duration":h=(null!=(a=null!=(t=null==m?void 0:m.durationMs)?t:e.durationMs)?a:0)-(null!=(r=null!=(n=null==x?void 0:x.durationMs)?n:s.durationMs)?r:0);break;case"contextUsage":h=(null!=(l=null==m?void 0:m.contextUsagePercent)?l:0)-(null!=(i=null==x?void 0:x.contextUsagePercent)?i:0);break;case"cost":h=(null!=(d=null==m||null==(o=m.cost)?void 0:o.total)?d:0)-(null!=(u=null==x||null==(c=x.cost)?void 0:c.total)?u:0)}return"asc"===w?h:-h}),e},[c,f,N,w,k,F,T]),D=null!==k.minDuration||null!==k.minContextUsage||null!==k.minCost,E=()=>{C({minDuration:null,minContextUsage:null,minCost:null})};return u&&0===c.length?(0,a.jsx)(sn,{}):(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{children:(0,a.jsx)(ee,{className:"text-lg",children:"Turn History"})}),(0,a.jsxs)(es,{children:[(0,a.jsxs)("div",{className:"mb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[200px]",children:[(0,a.jsx)(e6.A,{className:"absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(e2,{placeholder:"Search turns...",value:f,onChange:e=>j(e.target.value),className:"pl-8 h-9"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(e3,{value:N,onChange:e=>b(e.target.value),className:"w-[140px]",children:[(0,a.jsx)("option",{value:"turnNumber",children:"Turn #"}),(0,a.jsx)("option",{value:"duration",children:"Duration"}),(0,a.jsx)("option",{value:"contextUsage",children:"Context %"}),(0,a.jsx)("option",{value:"cost",children:"Cost"})]}),(0,a.jsx)(p,{variant:"outline",size:"icon",onClick:()=>{y(e=>"asc"===e?"desc":"asc")},className:"h-9 w-9",title:"asc"===w?"Ascending":"Descending",children:(0,a.jsx)(e8.A,{className:"h-4 w-4 ".concat("desc"===w?"rotate-180":"")})})]}),(0,a.jsxs)(p,{variant:A||D?"secondary":"outline",size:"sm",onClick:()=>S(!A),className:"h-9",children:[(0,a.jsx)(e9.A,{className:"h-4 w-4 mr-1"}),"Filters",D&&(0,a.jsx)(v,{variant:"default",className:"ml-1 h-5 px-1.5",children:[k.minDuration,k.minContextUsage,k.minCost].filter(e=>null!==e).length})]}),L>0&&(0,a.jsxs)(p,{variant:T?"secondary":"outline",size:"sm",onClick:()=>R(!T),className:"h-9",title:T?"Hide subagent turns":"Show subagent turns",children:[(0,a.jsx)(e7.A,{className:"h-4 w-4 mr-1"}),T?"Hide":"Show"," Subagents",(0,a.jsx)(v,{variant:"outline",className:"ml-1 h-5 px-1.5",children:L})]}),D&&(0,a.jsxs)(p,{variant:"ghost",size:"sm",onClick:E,className:"h-9",children:[(0,a.jsx)(eT.A,{className:"h-4 w-4 mr-1"}),"Clear"]})]}),A&&(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 p-3 bg-muted/50 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Duration:"}),(0,a.jsxs)(e3,{value:null!=(l=null==(s=k.minDuration)?void 0:s.toString())?l:"",onChange:e=>C(s=>({...s,minDuration:e.target.value?Number(e.target.value):null})),className:"w-[100px]",children:[(0,a.jsx)("option",{value:"",children:"Any"}),(0,a.jsx)("option",{value:"10",children:"> 10s"}),(0,a.jsx)("option",{value:"30",children:"> 30s"}),(0,a.jsx)("option",{value:"60",children:"> 1m"}),(0,a.jsx)("option",{value:"300",children:"> 5m"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Context:"}),(0,a.jsxs)(e3,{value:null!=(i=null==(t=k.minContextUsage)?void 0:t.toString())?i:"",onChange:e=>C(s=>({...s,minContextUsage:e.target.value?Number(e.target.value):null})),className:"w-[100px]",children:[(0,a.jsx)("option",{value:"",children:"Any"}),(0,a.jsx)("option",{value:"25",children:"> 25%"}),(0,a.jsx)("option",{value:"50",children:"> 50%"}),(0,a.jsx)("option",{value:"75",children:"> 75%"}),(0,a.jsx)("option",{value:"90",children:"> 90%"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Cost:"}),(0,a.jsxs)(e3,{value:null!=(o=null==(r=k.minCost)?void 0:r.toString())?o:"",onChange:e=>C(s=>({...s,minCost:e.target.value?Number(e.target.value):null})),className:"w-[110px]",children:[(0,a.jsx)("option",{value:"",children:"Any"}),(0,a.jsx)("option",{value:"0.01",children:"> $0.01"}),(0,a.jsx)("option",{value:"0.10",children:"> $0.10"}),(0,a.jsx)("option",{value:"0.50",children:"> $0.50"}),(0,a.jsx)("option",{value:"1.00",children:"> $1.00"})]})]})]}),(f||D||!T)&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",M.length," of ",c.length," turns",!T&&L>0&&(0,a.jsxs)("span",{className:"ml-1",children:["(",L," subagent turns hidden)"]})]})]}),(0,a.jsxs)(P,{className:"h-[500px] w-full",children:[(0,a.jsx)("div",{className:"space-y-2 pr-4 w-full max-w-full",children:0===M.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[(0,a.jsx)(e6.A,{className:"h-12 w-12 mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"No matching turns"}),(0,a.jsx)("p",{className:"text-sm",children:f?"Try a different search term":"Adjust your filters to see more results"}),(f||D)&&(0,a.jsx)(p,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>{j(""),E()},children:"Clear all filters"})]}):M.map(e=>{let s=F.get(e.id),t=h===e.id;return(0,a.jsx)(sa,{turn:e,metrics:s,isExpanded:t,onToggle:()=>g(t?null:e.id)},e.id)})}),x&&m&&M.length>0&&(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)(p,{variant:"outline",onClick:m,disabled:u,children:u?"Loading...":"Load More"})})]})]})]})}function sa(e){var s,t,n,r,l,i;let{turn:o,metrics:c,isExpanded:d,onToggle:u}=e;return(0,a.jsxs)("div",{className:"border rounded-lg",children:[(0,a.jsxs)("button",{onClick:u,className:"w-full text-left p-4 hover:bg-accent/50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-2 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,a.jsxs)(v,{variant:"outline",children:["Turn ",o.turnNumber]}),o.isSubagent&&(0,a.jsxs)(v,{variant:"secondary",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",children:[(0,a.jsx)(e7.A,{className:"h-3 w-3 mr-1"}),o.agentId||"Subagent"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-cyan-400 text-black text-xs font-medium whitespace-nowrap",children:[(0,a.jsx)(W.A,{className:"h-3 w-3 flex-shrink-0"}),x(null!=(n=null!=(t=null==c?void 0:c.durationMs)?t:o.durationMs)?n:0)]}),o.isSubagent?(0,a.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-300 text-gray-600 text-xs font-medium whitespace-nowrap",title:"Subagent context usage is not shown (uses separate context window)",children:[(0,a.jsx)(se.A,{className:"h-3 w-3 flex-shrink-0"}),"--"]}):(0,a.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-lime-400 text-black text-xs font-medium whitespace-nowrap",children:[(0,a.jsx)(se.A,{className:"h-3 w-3 flex-shrink-0"}),(null!=(r=null==c?void 0:c.contextUsagePercent)?r:0).toFixed(1),"%"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-fuchsia-400 text-black text-xs font-medium whitespace-nowrap tabular-nums",children:[(0,a.jsx)(H.A,{className:"h-3 w-3 flex-shrink-0"}),(i=null!=(l=null==c||null==(s=c.cost)?void 0:s.total)?l:0,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i))]})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:d?(0,a.jsx)(ss.A,{className:"h-4 w-4"}):(0,a.jsx)(e5.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:g(o.userMessage,100)}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate mt-1",children:g(o.assistantMessage,150)})]})]}),d&&(0,a.jsxs)("div",{className:"px-4 pb-4 border-t bg-muted/30",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"User Message"}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap bg-background p-3 rounded-md border",children:o.userMessage})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Assistant Response"}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap bg-background p-3 rounded-md border max-h-48 overflow-y-auto",children:o.assistantMessage})]})]}),o.toolUses.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("h4",{className:"font-medium mb-2",children:["Tool Uses (",o.toolUses.length,")"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:o.toolUses.map(e=>(0,a.jsx)(v,{variant:e.isError?"destructive":"secondary",children:e.name},e.id))})]}),o.codeChanges.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("h4",{className:"font-medium mb-2",children:["Code Changes (",o.codeChanges.length,")"]}),(0,a.jsx)("div",{className:"space-y-1 text-sm",children:o.codeChanges.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v,{variant:"create"===e.type?"success":"delete"===e.type?"destructive":"secondary",children:e.type}),(0,a.jsx)("span",{className:"font-mono truncate",children:e.filePath}),e.linesAdded>0&&(0,a.jsxs)("span",{className:"text-green-600",children:["+",e.linesAdded]}),e.linesRemoved>0&&(0,a.jsxs)("span",{className:"text-red-600",children:["-",e.linesRemoved]})]},s))})]}),c&&(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-background p-3 rounded-md border",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Input Tokens"}),(0,a.jsx)("p",{className:"font-medium",children:m(c.tokens.input)})]}),(0,a.jsxs)("div",{className:"bg-background p-3 rounded-md border",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Output Tokens"}),(0,a.jsx)("p",{className:"font-medium",children:m(c.tokens.output)})]}),(0,a.jsxs)("div",{className:"bg-background p-3 rounded-md border",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Cache Read"}),(0,a.jsx)("p",{className:"font-medium",children:m(c.tokens.cacheRead)})]}),(0,a.jsxs)("div",{className:"bg-background p-3 rounded-md border",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Context Usage"}),o.isSubagent?(0,a.jsx)("p",{className:"font-medium text-muted-foreground",title:"Subagent uses separate context window",children:"-- (subagent)"}):(0,a.jsxs)("p",{className:"font-medium",children:[c.contextUsagePercent.toFixed(1),"%"]})]})]})]})]})}function sn(){return(0,a.jsxs)(Y,{children:[(0,a.jsx)(Z,{children:(0,a.jsx)(K,{className:"h-6 w-32"})}),(0,a.jsx)(es,{children:(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:5}).map((e,s)=>(0,a.jsx)("div",{className:"border rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)(K,{className:"h-6 w-20"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(K,{className:"h-4 w-3/4 mb-2"}),(0,a.jsx)(K,{className:"h-3 w-1/2"})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(K,{className:"h-4 w-16"}),(0,a.jsx)(K,{className:"h-4 w-16"}),(0,a.jsx)(K,{className:"h-4 w-16"})]})]})},s))})})]})}var sr=t(70992);let sl=sr.bL,si=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(sr.B8,{ref:s,className:d("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n})});si.displayName=sr.B8.displayName;let so=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(sr.l9,{ref:s,className:d("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...n})});so.displayName=sr.l9.displayName;let sc=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(sr.UC,{ref:s,className:d("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});sc.displayName=sr.UC.displayName;var sd=t(22995);let su=t(77011).env.NEXT_PUBLIC_API_URL||"http://localhost:3100/api";class sm extends Error{constructor(e,s,t){super(s),this.status=e,this.data=t,this.name="APIError"}}async function sx(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(su).concat(e),a=await fetch(t,{...s,headers:{"Content-Type":"application/json",...s.headers}});if(!a.ok){let e=await a.json().catch(()=>({}));throw new sm(a.status,e.message||"HTTP error ".concat(a.status),e)}return a.json()}async function sh(e){let s=new URLSearchParams;(null==e?void 0:e.limit)&&s.set("limit",String(e.limit)),(null==e?void 0:e.activeOnly)&&s.set("activeOnly","true"),(null==e?void 0:e.projectPath)&&s.set("projectPath",e.projectPath);let t=s.toString();return sx("/sessions".concat(t?"?".concat(t):""))}async function sg(e){return sx("/sessions/".concat(e))}async function sf(e,s){let t=new URLSearchParams;(null==s?void 0:s.offset)&&t.set("offset",String(s.offset)),(null==s?void 0:s.limit)&&t.set("limit",String(s.limit));let a=t.toString();return sx("/sessions/".concat(e,"/turns").concat(a?"?".concat(a):""))}async function sp(e){return sx("/sessions/".concat(e,"/metrics"))}async function sj(){return sx("/sessions/scan",{method:"POST"})}var sv=t(35309),sN=t(52566),sb=t(21011);function sw(e){var s,t,l,i,o,c,d,u;let{sessionId:h,sessions:g,isLoadingSessions:f}=e,j=(0,r.useRouter)(),{data:v,isLoading:N,refetch:b}=(0,sd.I)({queryKey:sv.l.sessions.detail(null!=h?h:""),queryFn:()=>sg(h),enabled:!!h}),{data:w,isLoading:y}=function(e,s){let t=50;return(0,sd.I)({queryKey:sv.l.turns.list(null!=e?e:"",{limit:t}),queryFn:()=>sf(e,{limit:t}),enabled:!!e})}(h),{data:k,isLoading:C}=(0,sd.I)({queryKey:sv.l.metrics.session(null!=h?h:""),queryFn:()=>sp(h),enabled:!!h}),A=N||C,S=null==v?void 0:v.session,T=null==k?void 0:k.sessionMetrics,R=null==k?void 0:k.efficiency,F=null!=(s=null==k?void 0:k.turnMetrics)?s:[];return(0,n.useEffect)(()=>{if(F.length>0){var e,s;console.log("[SessionPage] turnMetrics count:",F.length),console.log("[SessionPage] First turn tokens:",null==(e=F[0])?void 0:e.tokens),console.log("[SessionPage] First turn cost:",null==(s=F[0])?void 0:s.cost)}},[F]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)(p,{variant:"ghost",onClick:()=>{j.push("/")},className:"gap-2",children:[(0,a.jsx)(eo.A,{className:"h-4 w-4"}),"Back to Dashboard"]})}),N?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(K,{className:"h-8 w-64"}),(0,a.jsx)(K,{className:"h-4 w-48"})]}):S?(0,a.jsx)(ec,{session:S,metrics:null!=T?T:null,onRefresh:()=>b(),isRefreshing:A}):(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Session not found"})}),S&&(0,a.jsxs)(sl,{defaultValue:"overview",className:"space-y-6",children:[(0,a.jsxs)(si,{children:[(0,a.jsx)(so,{value:"overview",children:"Overview"}),(0,a.jsx)(so,{value:"charts",children:"Charts"}),(0,a.jsx)(so,{value:"turns",children:"Turns"})]}),(0,a.jsxs)(sc,{value:"overview",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[(0,a.jsx)(er,{title:"Total Cost",value:T?"$".concat(T.totalCost.toFixed(4)):"$0.00",icon:H.A,iconColor:"text-green-600",isLoading:C}),(0,a.jsx)(er,{title:"Total Tokens",value:m(null!=(t=null==T?void 0:T.totalTokens.total)?t:0),icon:ea.A,iconColor:"text-yellow-600",isLoading:C}),(0,a.jsx)(er,{title:"Turns",value:m(null!=(l=null==T?void 0:T.totalTurns)?l:0),icon:et.A,iconColor:"text-blue-600",isLoading:C}),(0,a.jsx)(er,{title:"Duration",value:x(null!=(i=null==T?void 0:T.totalDurationMs)?i:0),icon:W.A,iconColor:"text-purple-600",isLoading:C}),(0,a.jsx)(er,{title:"Code Changes",value:m(null!=(o=null==T?void 0:T.totalCodeChanges.netLinesChanged)?o:0),subtitle:"net lines",icon:sN.A,iconColor:"text-orange-600",isLoading:C}),(0,a.jsx)(er,{title:"Tool Uses",value:m(null!=(c=null==T?void 0:T.totalToolUses)?c:0),icon:sb.A,iconColor:"text-cyan-600",isLoading:C})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[T&&(0,a.jsx)(ed,{totalCost:T.totalCost,costBreakdown:T.costBreakdown,avgCostPerTurn:T.averages.costPerTurn}),R&&(0,a.jsx)(ex,{efficiency:R}),T&&(0,a.jsx)(eQ,{value:T.averages.contextUsagePercent})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:F.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ez,{data:F,showBreakdown:!1}),(0,a.jsx)(eO,{data:F,showBreakdown:!1})]})}),T&&Object.keys(T.toolBreakdown).length>0&&(0,a.jsx)(e4,{toolBreakdown:T.toolBreakdown})]}),(0,a.jsxs)(sc,{value:"charts",className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:F.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ez,{data:F,showBreakdown:!0}),(0,a.jsx)(eO,{data:F,showBreakdown:!0}),(0,a.jsx)(eW,{data:F}),(0,a.jsx)(eZ,{data:F})]}):(0,a.jsx)("div",{className:"col-span-2 text-center py-12 text-muted-foreground",children:(0,a.jsx)("p",{children:"No turn data available for charts"})})}),T&&Object.keys(T.toolBreakdown).length>0&&(0,a.jsx)(e4,{toolBreakdown:T.toolBreakdown})]}),(0,a.jsx)(sc,{value:"turns",children:(0,a.jsx)(st,{turns:null!=(d=null==w?void 0:w.turns)?d:[],metrics:null!=(u=null==w?void 0:w.metrics)?u:[],isLoading:y})})]})]})}var sy=t(4869);let sk=t(77011).env.NEXT_PUBLIC_SSE_URL||"http://localhost:3100/api/sse";class sC{getStatus(){return this.status}onStatusChange(e){this.statusHandler=e}setStatus(e){var s;this.status=e,null==(s=this.statusHandler)||s.call(this,e)}connect(){this.eventSource&&this.disconnect(),this.setStatus("connecting");let e=new URL(sk);this.options.sessionId&&e.searchParams.set("sessionId",this.options.sessionId),this.eventSource=new EventSource(e.toString()),this.eventSource.onopen=()=>{this.setStatus("connected"),this.reconnectAttempts=0},this.eventSource.onerror=()=>{this.setStatus("error"),this.handleReconnect()},["connected","session","turn","metrics","heartbeat","error"].forEach(e=>{var s;null==(s=this.eventSource)||s.addEventListener(e,s=>{try{if(!s.data)return;let t=JSON.parse(s.data);this.emit(e,{event:e,data:t})}catch(s){console.error("Failed to parse SSE event: ".concat(e),s)}})})}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.setStatus("disconnected"),this.reconnectAttempts=0}handleReconnect(){if(!this.options.autoReconnect)return void this.disconnect();if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("Max reconnect attempts reached"),this.disconnect();return}this.reconnectAttempts++;let e=this.options.reconnectDelay*Math.pow(1.5,this.reconnectAttempts-1);this.reconnectTimeout=setTimeout(()=>{this.connect()},e)}on(e,s){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(s),()=>{var t;null==(t=this.handlers.get(e))||t.delete(s)}}emit(e,s){var t;null==(t=this.handlers.get(e))||t.forEach(t=>{try{t(s)}catch(s){console.error("Error in SSE event handler for ".concat(e,":"),s)}})}constructor(e={}){var s,t,a,n;this.eventSource=null,this.handlers=new Map,this.statusHandler=null,this.status="disconnected",this.reconnectAttempts=0,this.reconnectTimeout=null,this.options={sessionId:null!=(s=e.sessionId)?s:void 0,autoReconnect:null==(t=e.autoReconnect)||t,reconnectDelay:null!=(a=e.reconnectDelay)?a:3e3,maxReconnectAttempts:null!=(n=e.maxReconnectAttempts)?n:10}}}let sA=null,sS={currentSessionId:null,currentSession:null,sessionMetrics:null,turns:[],sessions:[],totalSessions:0,isLoading:!1,isLoadingTurns:!1},sT=(0,k.v)(e=>({...sS,setCurrentSession:s=>{var t;return e({currentSession:s,currentSessionId:null!=(t=null==s?void 0:s.id)?t:null})},setSessionMetrics:s=>e({sessionMetrics:s}),setTurns:s=>e({turns:s}),addTurn:s=>e(e=>({turns:[...e.turns,s]})),updateTurn:s=>e(e=>({turns:e.turns.map(e=>e.id===s.id?s:e)})),setSessions:(s,t)=>e({sessions:s,totalSessions:t}),setLoading:s=>e({isLoading:s}),setLoadingTurns:s=>e({isLoadingTurns:s}),reset:()=>e(sS)}));function sR(){return(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)("div",{className:"h-14 border-b bg-background"}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-80 h-screen border-r bg-background"}),(0,a.jsxs)("main",{className:"flex-1 p-6",children:[(0,a.jsx)(K,{className:"h-8 w-64 mb-4"}),(0,a.jsx)(K,{className:"h-4 w-48 mb-8"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsx)(K,{className:"h-24"}),(0,a.jsx)(K,{className:"h-24"}),(0,a.jsx)(K,{className:"h-24"}),(0,a.jsx)(K,{className:"h-24"})]})]})]})]})}function sF(){var e,s,t,l,i;let o=(0,r.useSearchParams)().get("session"),{sidebarCollapsed:c,setSidebarCollapsed:u,theme:m}=S(),{data:x,isLoading:h}=(i={limit:20},(0,sd.I)({queryKey:sv.l.sessions.list({limit:null==i?void 0:i.limit,activeOnly:null==i?void 0:i.activeOnly}),queryFn:()=>sh(i),refetchInterval:3e4})),{status:g,connect:f}=function(e){let[s,t]=(0,n.useState)("disconnected"),[a,r]=(0,n.useState)(!1),l=(0,n.useRef)(null),i=(0,n.useRef)(!1),o=(0,sy.jE)(),{setCurrentSession:c,setSessionMetrics:d,addTurn:u,updateTurn:m}=sT(),x=S(e=>e.realTimeEnabled),h=(0,n.useCallback)(async()=>{if(!i.current){i.current=!0;try{let e=await sj();console.log("[SSE] Initial scan complete: ".concat(e.loaded," files loaded, ").concat(e.skipped," skipped")),r(!0),o.invalidateQueries({queryKey:sv.l.sessions.all})}catch(e){console.warn("[SSE] Failed to scan existing sessions:",e),r(!0)}}},[o]),g=(0,n.useCallback)(()=>{var s;if(!x)return;l.current&&l.current.disconnect();let a=(s={sessionId:e},(!sA||s)&&(sA=new sC(s)),sA);l.current=a,a.onStatusChange(t),a.on("session",e=>{let{session:s,metrics:t}=e.data;c(s),d(t),o.invalidateQueries({queryKey:sv.l.sessions.all})}),a.on("turn",s=>{let{type:t,turn:a}=s.data;"new"===t?u(a):m(a),e&&o.invalidateQueries({queryKey:sv.l.turns.list(e,{})})}),a.on("metrics",s=>{let{sessionMetrics:t}=s.data;d(t),e&&o.invalidateQueries({queryKey:sv.l.metrics.session(e)})}),a.connect(),h()},[e,x,o,c,d,u,m,h]),f=(0,n.useCallback)(()=>{l.current&&(l.current.disconnect(),l.current=null),t("disconnected")},[]);return(0,n.useEffect)(()=>(x&&g(),()=>{f()}),[g,f,x]),(0,n.useEffect)(()=>{x&&e&&g()},[e,x,g]),{status:s,isConnected:"connected"===s,isConnecting:"connecting"===s,isError:"error"===s,scanComplete:a,connect:g,disconnect:f}}(null!=o?o:void 0);return(0,n.useEffect)(()=>{let e=document.documentElement;"dark"===m?e.classList.add("dark"):"light"===m?e.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?e.classList.add("dark"):e.classList.remove("dark")},[m]),(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)(U,{connectionStatus:g,onReconnect:f,onToggleSidebar:()=>u(!c)}),(0,a.jsx)(X,{sessions:null!=(e=null==x?void 0:x.sessions)?e:[],selectedSessionId:o,isLoading:h}),(0,a.jsx)(G,{isCollapsed:c,onToggle:()=>u(!1)}),(0,a.jsx)("main",{className:d("transition-all duration-300 pt-6 pb-8",c?"ml-0":"ml-80"),children:(0,a.jsx)("div",{className:"container",children:o?(0,a.jsx)(sw,{sessionId:o,sessions:null!=(s=null==x?void 0:x.sessions)?s:[],isLoadingSessions:h}):(0,a.jsx)(el,{sessions:null!=(t=null==x?void 0:x.sessions)?t:[],total:null!=(l=null==x?void 0:x.total)?l:0,isLoading:h})})})]})}function sL(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)(sR,{}),children:(0,a.jsx)(sF,{})})}},62072:(e,s,t)=>{Promise.resolve().then(t.bind(t,44572))}},e=>{e.O(0,[51,30,587,18,358],()=>e(e.s=62072)),_N_E=e.O()}]);